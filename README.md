# コンテキストプレイヤー

For english, see [README_en.md](README_en.md).

## 特徴

Android スマホ用の音楽再生プレイヤーです。

世の中、プレイリスト対応プレイヤーは数多くありますが、
別のプレイリストに行って戻った時、前回の再生位置から再生してくれるものは、
そうはありません。

また、フォルダ構成をプレイリスト代わりにしており、ファイルの path 順に
再生して欲しいのですが、これもなかなか対応しているアプリは少ないです。

こんな感じの機能を持ったアプリとして、
日本語名「音楽フォルダプレイヤー」(de.zorillasoft.musicfolderplayer)がありますが、
これはフォルダ内を再帰的に再生してくれず、私の好みに合いませんでした。

この「コンテキストプレイヤー」は、そういった機能を備えています。
ただし、そこに重点を置き、他の機能はできるだけ削減しています。

## インストール

今のところ、Google Play には上げていませんので、Android Studio 等で
インストールしてください。

以下の権限を使用します。
- android.permission.READ_EXTERNAL_STORAGE

  内部ストレージにアクセスするため。

- android.permission.BLUETOOTH

  Bluetooth ヘッドセットが OFF されたら再生を停止するため。

動作確認環境:
- Xperia X Performance (au SOV33)
- Android 6.0.1

## 使い方

まず、ストレージへのアクセス権限を要求されるので、許可して下さい。
メイン画面が表示されます。

- メイン画面

  - 選択しているコンテキストの名前を表示しています

    コンテキストとは、

      - 名前
      - 再生するフォルダ階層のトップ
      - 再生中のファイル名
      - 再生中の位置

    をまとめた情報です。

    タップすると、コンテキストリスト画面に移動します。

  - 再生中曲情報

    再生中のファイル path、曲名、アーティスト名が表示されます。
    ファイル path は、トップフォルダまでの部分の背景を灰色にしています。
    
    タップすると、Explorer 画面に移動します。

  - シークバー

    曲中の再生位置を表示しています。スライドすればシークできます。

  - 各ボタン

    前/再生/一時停止/次の4つのボタンが表示されています。
    「前」については、再生位置が3秒までなら前の曲の先頭へ戻り、3秒以上なら
    再生中の曲の先頭へ戻ります。

- コンテキストリスト

  - リスト

    コンテキストのリストが表示されます。表示順は作成順です。
    タップすると、そのコンテキストに切り替わり、再生が再開されます。
    ロングタップすると、コンテキスト名の編集やコンテキストの削除が
    できます。

  - ボタン

    新しいコンテキストを作成できます。

- Explorer 画面

  - path

    現在表示されているフォルダの path を表示しています。
    現在選択中のコンテキストを参照し、トップフォルダまでの部分の背景は
    灰色表示になっています。

  - リスト

    - ディレクトリの場合

      ディレクトリ名を表示しています。
      タップするとそのディレクトリへ移動します。ロングタップすると現在
      選択中のコンテキストのトップフォルダをそのディレクトリに変更します。

    - 通常ファイルの場合

      ファイル名、ファイルの種類、曲名、アーティスト名を表示しています。
      タップすると、そのファイルを再生します。もしその曲が再生できない場合、
      スキップして次のファイルを再生します。

## 再生順

トップフォルダ以下、再帰的に全てのファイルをリストアップし、
path でソートして、その順に再生します。

ただし、以下の例外があります。
- `.` で始まるファイルやフォルダは無視
- 大文字小文字は無視

また、Explorer でファイルの種類が表示されていなくても、再生できるなら
再生しています。

## その他

- Bluetooth ヘッドセット

  OFF すると再生が止まります。直後に一瞬本体から音が鳴ることがあるようですが。

- 曲ファイルを置く場所

  よく知りませんが、たぶん機種ごとに音楽ファイルを置く場所が決まっていて、
  以下の API で取得できるようになっています。
```
    Environment.getExternalStoragePublicDirectory(Environment.DIRECTORY_MUSIC);
```
  例えば私の環境では `/storage/emulated/0/Music` のようです。
  このアプリはそこしか参照しませんので、その中に置いて下さい。

## 機能追加及びバグについて

これ以上機能を追加する気はほとんどありません。
例えば、以下のような機能を追加する予定は全くありません。

- albumart
- equalizer
- 歌詞
- CDDB
- shuffle

まぁもしどうしても欲しい機能があれば、私を説得してみてください。
基本的に私が欲しい機能しか作るつもりはありませんが、
気が向けば実装するかもしれません。

バグについては修正します。たぶん。きっと。
現在判明しているバグは、以下のとおりです。

- 曲名が化ける場合がある

## ライセンス

GPLv3 です。COPYING3 を参照してください。

このアプリは Activeandroid を使用しています。
Activeandroid のライセンスは Apache License 2.0 です。
LICENSE-2.0.txt を参照してください。

## 作者

Yuuki Harano &lt;masm@masm11.ddo.jp&gt;
